!function(){window.x={}}(),window.x.util=function(){var e=new DOMParser;return{text_to_json:function(e){try{return JSON.parse(e)}catch(e){return}},text_to_doc:function(t){return e.parseFromString(t,"text/html")},html_to_doc:function(t){return e.parseFromString(t,"text/html")},doc_to_val:function(e){var t=e[0],n=e[1],r=e[2],o=e[3];if("length"===r)return t.querySelectorAll(n).length;var i=t.querySelector(n);return i?"text"===r?i.innerText:"html"===r?i.innerHTML:"attr"===r?i.getAttribute(o):"value"===r?i.value:null:null},normalize_links:function(e){for(var t=e.querySelectorAll("a"),n=t.length;n--;)t[n].href=t[n].href;return e},query:function(e){if("undefined"==typeof e.method){for(var t=e[0],n=e[1],r=[],o=t.length;o--;){for(var i=!0,c=Object.keys(n),u=c.length;u--;){var d=c[u];n[d]!==t[o][d]&&(i=!1)}i&&r.push(t[o])}return r}if("remove"===e.method)for(var o=e.arr.length;o--;){for(var a=e.arr[o],s=!0,l=Object.keys(e.q||{}),f=Object.keys(e.nq||{}),u=l.length;u--;)a[l[u]]!==e.q[l[u]]&&(s=!1);for(var u=f.length;u--;)a[f[u]]===e.q[f[u]]&&(s=!1);s===!0&&e.arr.splice(o,1)}else if("find"===e.method){for(var r=[],o=e.arr.length;o--;){for(var a=e.arr[o],s=!0,l=Object.keys(e.q||{}),f=Object.keys(e.nq||{}),u=l.length;u--;)a[l[u]]!==e.q[l[u]]&&(s=!1);for(var u=f.length;u--;)a[f[u]]===e.q[f[u]]&&(s=!1);s===!0&&r.push(e.arr[o])}return r}},extend:function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},filter:function(e){for(var t=Object.keys(e),n=t.length;n--;)e[t[n]]||delete e[t[n]];return e}}}(),window.x.hub=function(){return{send:function(){},listen:function(){},send_runtime_message_rq_to_rs:function(e){window.chrome.runtime.sendMessage(e)},send_tab_message_rq_to_rs:function(e){return e.all_tabs_flag?void window.chrome.tabs.query({},function(t){t.forEach(function(t){window.chrome.tabs.sendMessage(t.id,e)})}):new Promise(function(t){window.chrome.tabs.sendMessage(e.tab_id,e,t)})}}}(),window.x.ajax=function(){return{fetch_rq_to_rs:function(e){var t=new Headers(e.headers||{});return"get_json"===e.method?window.fetch(e.url,{method:"GET",credentials:"include",headers:t}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null}):"get_doc"===e.method?window.fetch(e.url,{method:"GET",credentials:"include",headers:t}).then(function(e){return e.text().then(function(e){return x.util.text_to_doc(e)})}).catch(function(e){return null}):"get_blob"===e.method?window.fetch(e.url,{method:"GET",credentials:"include",headers:t}).then(function(e){return e.blob()}).catch(function(e){return null}):"get_text"===e.method?window.fetch(e.url,{method:"GET",credentials:"include",headers:t}).then(function(e){return e.text()}).catch(function(e){return null}):"post_json_get_json"===e.method?(t.append("Content-Type","application/json"),window.fetch(e.url,{method:"POST",credentials:"include",body:JSON.stringify(e.body),headers:t}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null})):void 0},http_rq_to_rs:function(e){var t;return"POST"===e.method&&"application/x-www-form-urlencoded"===e.content_type?t=x.ajax.obj_to_form_data(e.body):"POST"===e.method&&"application/json"===e.content_type&&(t=JSON.stringify(e.body)),window.fetch(e.url,{method:e.method,credentials:"include",headers:new Headers({"Content-Type":e.content_type,Accept:e.accept}),body:t}).then(function(t){return t.text().then(function(n){return{head:{error:!1,code:0,http_req:e,status:t.status,headers:t.headers},body:{text:n}}})}).catch(function(t){return{head:{error:!0,code:1,http_req:e}}})},obj_to_form_data:function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},xhr_rq_to_rs:function(e){return new Promise(function(t){function n(){}function r(){t(200===this.status?{error:!1,response:this.response}:{error:!0})}function o(){t({error:!0})}var i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),e.timeout&&(i.timeout=e.timeout),i.responseType=e.response_type||"text",e.headers&&Object.keys(e.headers).forEach(function(t){i.setRequestHeader(t,e.headers[t])}),"json"===e.rq_body_type&&i.setRequestHeader("Content-Type","application/json"),i.addEventListener("load",r),i.addEventListener("error",o),i.addEventListener("timeout",n),"json"===e.rq_body_type)var c=JSON.stringify(e.rq_body);else if("form_data"===e.rq_body_type){var c=new FormData;Object.keys(e.rq_body).forEach(function(t){c.append(t,e.rq_body[t])})}else var c=null;i.send(c)})}}}(),window.x.query=function(){return{query:function(e){if("undefined"==typeof e.method){for(var t=e[0],n=e[1],r=[],o=t.length;o--;){for(var i=!0,c=Object.keys(n),u=c.length;u--;){var d=c[u];n[d]!==t[o][d]&&(i=!1)}i&&r.push(t[o])}return r}if("remove"===e.method)for(var o=e.arr.length;o--;){for(var a=e.arr[o],s=!0,l=Object.keys(e.q||{}),f=Object.keys(e.nq||{}),u=l.length;u--;)a[l[u]]!==e.q[l[u]]&&(s=!1);for(var u=f.length;u--;)a[f[u]]===e.q[f[u]]&&(s=!1);s===!0&&e.arr.splice(o,1)}else if("find"===e.method){for(var r=[],o=e.arr.length;o--;){for(var a=e.arr[o],s=!0,l=Object.keys(e.q||{}),f=Object.keys(e.nq||{}),u=l.length;u--;)a[l[u]]!==e.q[l[u]]&&(s=!1);for(var u=f.length;u--;)a[f[u]]===e.q[f[u]]&&(s=!1);s===!0&&r.push(e.arr[o])}return r}}}}(),window.x.storage=function(){return{get:function(e){var t,n=e.split(".");return new Promise(function(e){window.chrome.storage.local.get(null,function(r){t=r;for(var o=0;o<n.length;o++){if(void 0===typeof t[n[o]]){e(void 0);break}t=t[n[o]]}e(t)})})},set:function(e,t){var n,r=e.split(".");return new Promise(function(e){window.chrome.storage.local.get(null,function(o){n=o;for(var i=0;i<r.length;i++)if(i===r.length-1)n[r[i]]=t;else{if(void 0===typeof n[r[i]]){e(!1);break}n=n[r[i]]}window.chrome.storage.local.set(o,e.bind(this,!0))})})}}}(),window.x.detector=function(){return{detect:function(e){if(e.type="default"){for(var t=e.selector,n=e.callback,r=window.document.querySelectorAll(t),o=0;o<r.length;o++)"1"!==r[0].dataset.detected&&(r[0].dataset.detected="1",n(r[0]));var i=new MutationObserver(function(e){var r=window.document.querySelectorAll(t);if(r)for(var o=0;o<r.length;o++)"1"!==r[o].dataset.detected&&(r[o].dataset.detected="1",n(r[o]))});i.observe(window.document,{childList:!0,subtree:!0})}else if(e.type="one_time_promise")return new Promise(function(n){var r=window.document.querySelector(e.selector);if(r)n(r);else{var o=new MutationObserver(function(){var e=window.document.querySelector(t);e&&(n(e),o.disconnect(window.document))});o.observe(window.document,{childList:!0,subtree:!0})}})},selector_to_element:function(e){return new Promise(function(t){var n=window.document.querySelector(e);if(n)t(n);else{var r=new MutationObserver(function(){var n=window.document.querySelector(e);n&&(t(n),r.disconnect(window.document))});r.observe(window.document,{childList:!0,subtree:!0})}})},detect:function(e,t){for(var n=window.document.querySelectorAll(e),r=0;r<n.length;r++)"1"!==n[0].dataset.detected&&(n[0].dataset.detected="1",t(n[0]));var o=new MutationObserver(function(n){var r=window.document.querySelectorAll(e);if(r)for(var o=0;o<r.length;o++)"1"!==r[o].dataset.detected&&(r[o].dataset.detected="1",t(r[o]))});o.observe(window.document,{childList:!0,subtree:!0})}}}();