/*{"current_version":"1.2.0","build_id":95,"github_url":"https://github.com/bashvlas/x"}*/
!function(){window.x={}}(),window.x.util=function(){var e=new DOMParser;return{inject_scripts:function(e,t){return new Promise(function(n){var o=t.splice(0,1)[0];chrome.tabs.executeScript(e,{file:o},function(){t.length>0?x.util.inject_scripts(e,t).then(n):n()})})},open_new_tab:function(e){chrome.tabs.create({active:!0,url:e})},send_to_all_tabs:function(e){chrome.tabs.query({},function(t){t.forEach(function(t){chrome.tabs.sendMessage(t.id,e)})})},list_to_arr:function(e){return Array.prototype.slice.call(e)},text_to_json:function(e){try{return JSON.parse(e)}catch(e){return}},text_to_doc:function(t){return e.parseFromString(t,"text/html")},html_to_doc:function(t){return e.parseFromString(t,"text/html")},doc_to_val:function(e){var t=e[0],n=e[1],o=e[2],r=e[3];if("length"===o)return t.querySelectorAll(n).length;var i=t.querySelector(n);return i?"text"===o?i.innerText:"html"===o?i.innerHTML:"attr"===o?i.getAttribute(r):"value"===o?i.value:null:null},is_defined:function(e){return"undefined"!=typeof e},is_undefined:function(e){return"undefined"==typeof e},normalize_links:function(e){for(var t=e.querySelectorAll("a"),n=t.length;n--;)t[n].href=t[n].href;return e},query:function(e){if("undefined"==typeof e.method){for(var t=e[0],n=e[1],o=[],r=t.length;r--;){for(var i=!0,c=Object.keys(n),u=c.length;u--;){var a=c[u];n[a]!==t[r][a]&&(i=!1)}i&&o.push(t[r])}return o}if("remove"===e.method)for(var r=e.arr.length;r--;){for(var s=e.arr[r],f=!0,l=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),u=l.length;u--;)s[l[u]]!==e.q[l[u]]&&(f=!1);for(var u=d.length;u--;)s[d[u]]===e.q[d[u]]&&(f=!1);f===!0&&e.arr.splice(r,1)}else if("find"===e.method){for(var o=[],r=e.arr.length;r--;){for(var s=e.arr[r],f=!0,l=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),u=l.length;u--;)s[l[u]]!==e.q[l[u]]&&(f=!1);for(var u=d.length;u--;)s[d[u]]===e.q[d[u]]&&(f=!1);f===!0&&o.push(e.arr[r])}return o}},extend:function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},filter:function(e){for(var t=Object.keys(e),n=t.length;n--;)e[t[n]]||delete e[t[n]];return e},wait:function(e){return new Promise(function(t){setTimeout(t,e)})},cookie_to_hash:function(e){for(var t=e.split(/;\s*/),n={},o=0;o<t.length;o++)t[o]=t[o].split("="),n[t[o][0]]=t[o][1];return n},pad:function(e){return e<10?"0"+e:""+e},trigger:function(e,t){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}else e.fireEvent("on"+t)},open_window_with_post_data:function(e,t){var n=document.createElement("form"),o=document.createElement("input");n.action=e,n.method="POST",n.target="_blank",o.name="data",o.value=JSON.stringify(t),n.appendChild(o),n.style.display="none",document.body.appendChild(n),n.submit()}}}(),window.x.procedures=function(){return{load_config:function(){return x.ajax({method:"get_json",url:chrome.extension.getURL("/config.json")}).then(function(e){return new Promise(function(t){chrome.storage.local.set({config:e},function(){t(e)})})})}}}(),window.x.hub=function(){function e(e,n){"undefined"==typeof t[e]&&(t[e]=[]),t[e].push(n)}var t={};return{fire:function(e,n){"undefined"!=typeof t[e]&&(n=n?n:{},n.event_name=e,t[e].forEach(function(e){e(n)}))},add:function(t){Object.keys(t).forEach(function(n){e(n,t[n])})},send_runtime_message_rq_to_rs:function(e){window.chrome.runtime.sendMessage(e)},send_tab_message_rq_to_rs:function(e){return e.all_tabs_flag?void window.chrome.tabs.query({},function(t){t.forEach(function(t){window.chrome.tabs.sendMessage(t.id,e)})}):new Promise(function(t){window.chrome.tabs.sendMessage(e.tab_id,e,t)})}}},window.x.tester=function(){return{test_conv:function(e,t){x.ajax({method:"get_json",url:t}).then(function(t){Object.keys(t).forEach(function(n){t[n].forEach(function(t){var o=n.split("_to_")[0],r=n.split("_to_")[1];Promise.all([x.tester.unserialize(t.input),x.tester.unserialize(t.output)]).then(function(t){var n=t[0],i=t[1],c=x.conv.get_conv_data(e,o,r,n),u=x.tester.compare(i,c.output);x.tester.log_test_case(c,n,i,u)})})})})},unserialize:function(e){return new Promise(function(t){if(null===e||"object"!=typeof e)t(e);else if("element"===e.__serial_type__)t(x.tester.html_to_element(e.html));else if("date"===e.__serial_type__)t(new Date(e.ts));else if("page_data"===e.__serial_type__)x.ajax({method:"get_text",url:"pages/"+encodeURIComponent(encodeURIComponent(e.url))}).then(function(n){t({url:e.url,text:n,doc:x.util.html_to_doc(n)})});else{var n=Object.keys(e).length,o=0;Object.keys(e).forEach(function(r){x.tester.unserialize(e[r]).then(function(i){e[r]=i,o+=1,o===n&&t(e)})}),0===Object.keys(e).length&&t(e)}})},html_to_element:function(e){var t=new DOMParser,n=t.parseFromString(e,"text/html");return n.body.firstElementChild},compare:function(e,t){if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(null===e&&null===t)return!0;if("object"==typeof e&&"object"==typeof t&&null!==e&&null!==t){for(var n,o=Object.keys(e),r=Object.keys(t),i=o.length;i--;)if(n=x.tester.compare(e[o[i]],t[o[i]]),n===!1)return!1;for(var i=r.length;i--;)if(n=x.tester.compare(e[r[i]],t[r[i]]),n===!1)return!1;return!0}return!1},log_test_case:function(e,t,n,o){var r=o?"color:green":"color:red";console.groupCollapsed("%c "+e.namespace+": "+e.from_name+" => "+e.to_name,r),console.log(t),console.log(n),console.log(e.output),x.conv.log_conv_data(e),console.groupEnd()}}}(),window.x.ajax=function(){function e(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function t(e){var t;return"POST"===e.method&&"application/x-www-form-urlencoded"===e.content_type?t=x.ajax.obj_to_form_data(e.body):"POST"===e.method&&"application/json"===e.content_type&&(t=JSON.stringify(e.body)),window.fetch(e.url,{method:e.method,credentials:"include",headers:new Headers({"Content-Type":e.content_type,Accept:e.accept}),body:t}).then(function(t){return t.text().then(function(n){return{head:{error:!1,code:0,http_req:e,status:t.status,headers:t.headers},body:{text:n}}})}).catch(function(t){return{head:{error:!0,code:1,http_req:e}}})}function n(e){return new Promise(function(t){function n(){}function o(){t(200===this.status?{error:!1,status:this.status,response:this.response}:{status:this.status,error:!0})}function r(){t({status:this.status,error:!0})}var i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),e.timeout&&(i.timeout=e.timeout),i.responseType=e.response_type||"text",e.headers&&Object.keys(e.headers).forEach(function(t){i.setRequestHeader(t,e.headers[t])}),"json"===e.rq_body_type&&i.setRequestHeader("Content-Type","application/json"),i.addEventListener("load",o),i.addEventListener("error",r),i.addEventListener("timeout",n),"json"===e.rq_body_type)var c=JSON.stringify(e.rq_body);else if("form_data"===e.rq_body_type){var c=new FormData;Object.keys(e.rq_body).forEach(function(t){c.append(t,e.rq_body[t])})}else var c=null;i.send(c)})}function o(o){var r=new Headers(o.headers||{}),i=o.credentials||"include";return"get_json"===o.method?window.fetch(o.url,{method:"GET",credentials:"include",headers:r}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null}):"get_doc"===o.method?window.fetch(o.url,{method:"GET",credentials:i,headers:r}).then(function(e){return e.text().then(function(e){return x.util.text_to_doc(e)})}).catch(function(e){return null}):"get_blob"===o.method?window.fetch(o.url,{method:"GET",credentials:i,headers:r}).then(function(e){return e.blob()}).catch(function(e){return null}):"get_text"===o.method?window.fetch(o.url,{method:"GET",credentials:i,headers:r}).then(function(e){return e.text()}).catch(function(e){return null}):"post_json_get_json"===o.method?(r.append("Content-Type","application/json"),window.fetch(o.url,{method:"POST",credentials:i,body:JSON.stringify(o.body),headers:r}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null})):"post"===o.method?(r.append("Content-Type","application/x-www-form-urlencoded"),window.fetch(o.url,{method:"POST",credentials:i,body:e(o.body),headers:r}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null})):"http"===o.method?t(o.data):"xhr"===o.method?n(o.data):void 0}return o}(),window.x.query=function(){return{query:function(e){if("undefined"==typeof e.method){for(var t=e[0],n=e[1],o=[],r=t.length;r--;){for(var i=!0,c=Object.keys(n),u=c.length;u--;){var a=c[u];n[a]!==t[r][a]&&(i=!1)}i&&o.push(t[r])}return o}if("remove"===e.method)for(var r=e.arr.length;r--;){for(var s=e.arr[r],f=!0,l=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),u=l.length;u--;)s[l[u]]!==e.q[l[u]]&&(f=!1);for(var u=d.length;u--;)s[d[u]]===e.q[d[u]]&&(f=!1);f===!0&&e.arr.splice(r,1)}else if("find"===e.method){for(var o=[],r=e.arr.length;r--;){for(var s=e.arr[r],f=!0,l=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),u=l.length;u--;)s[l[u]]!==e.q[l[u]]&&(f=!1);for(var u=d.length;u--;)s[d[u]]===e.q[d[u]]&&(f=!1);f===!0&&o.push(e.arr[r])}return o}}}}(),window.x.storage=function(){return{get:function(e){var t,n=e.split(".");return new Promise(function(e){window.chrome.storage.local.get(null,function(o){t=o;for(var r=0;r<n.length;r++){if(void 0===typeof t[n[r]]){e(void 0);break}t=t[n[r]]}e(t)})})},set:function(e,t){var n,o=e.split(".");return new Promise(function(e){window.chrome.storage.local.get(null,function(r){n=r;for(var i=0;i<o.length;i++)if(i===o.length-1)n[o[i]]=t;else{if(void 0===typeof n[o[i]]){e(!1);break}n=n[o[i]]}window.chrome.storage.local.set(r,e.bind(this,!0))})})}}}(),window.x.detect=function(){function e(e){var t=e.root||document,n=e.callback,o=e.method||"normal",r=e.selector||"*";if("normal"===o){t=t||document;for(var i=t.querySelectorAll(r),c=0;c<i.length;c++)"1"!==i[c].dataset.detected&&(i[c].dataset.detected="1",n(i[c]));var u=new MutationObserver(function(e){var o=t.querySelectorAll(r);if(o)for(var i=0;i<o.length;i++)"1"!==o[i].dataset.detected&&(o[i].dataset.detected="1",n(o[i]))});u.observe(t,{childList:!0,subtree:!0})}else{if("once"===o)return new Promise(function(e){var n=t.querySelector(r);if(n)e(n);else{var o=new MutationObserver(function(){var n=t.querySelector(r);n&&(e(n),o.disconnect(t))});o.observe(t,{childList:!0,subtree:!0})}});if("wait_for"===o)return new Promise(function(e){var n=!1,o=$(r,t).get(0);if(o)e(o);else{var i=new MutationObserver(function(){n===!1&&(o=$(r,t).get(0),o&&(e(o),i.disconnect(t),n=!0))});i.observe(t,{childList:!0,subtree:!0})}})}}return e}(),window.x.bg_api=function(){if("undefined"!=typeof chrome.extension){var e={};return chrome.runtime.onMessage.addListener(function(t,n,o){if("bg_api"===t._target&&e[t.api_name]&&e[t.api_name][t.method_name]){var r=e[t.api_name][t.method_name](t.input,n);if(r instanceof Promise)return r.then(o),!0;o(r)}}),{register:function(t,n){e[t]=n},exec:function(e,t,n){return new Promise(function(o){chrome.runtime.sendMessage({_target:"bg_api",api_name:e,method_name:t,input:n},o)})}}}}(),window.x.conv=function(){function e(e,t,c,u){if(n.debug){var a=r(e,t,c,u);return n.silence&&n.silence.indexOf(t+"_to_"+c)===-1&&(x.conv.log_conv_data(a),o.push(a)),a.output}return i(e,t,c,u)}var t={},n={debug:!0,silence:[]},o=[],r=function(){var e=function(n,o,r,i){function c(t,n,o,r){var i=e(t,n,o,r);return s.conv_data_arr.push(i),i.output}var u=t[n],a=o+"_to_"+r,s={namespace:n,from_name:o,to_name:r,conv_data_arr:[],found:!0,input:i,output:void 0};if(u[a])try{s.output=u[a](i,c),s.output instanceof Promise&&(s.output=new Promise(function(e){s.output.then(function(t){e(t)}).catch(function(e){s.error=!0,s.stack=e.stack})}))}catch(e){s.error=!0,s.stack=e.stack}else s.found=!1;return s};return e}(),i=function(){var e=function(n,o,r,i){var c=t[n];if(c&&c[o+"_to_"+r])try{var u=c[o+"_to_"+r](i,e);return u instanceof Promise?new Promise(function(e,t){u.then(function(t){e(t)}).catch(function(t){e(void 0)})}):u}catch(e){return}};return e}();return e.register=function(e,n){t[e]=n},e.set_options=function(e){n=e},e.log_conv_data=function(e){var t="%c "+e.namespace+": "+e.from_name+" => "+e.to_name;e.error?(console.groupCollapsed(t,"color: red"),console.log(e.input),console.log(e.stack)):e.found?(console.groupCollapsed(t,"color: green"),console.log(e.input),console.log(e.output)):(console.groupCollapsed(t,"color: #F0AD4E"),console.log(e.input)),e.conv_data_arr.forEach(function(e){x.conv.log_conv_data(e)}),console.groupEnd()},e.get_conv_data=r,e.flush=function(){o.forEach(e.log_conv_data)},e}();