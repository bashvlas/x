/*{"current_version":"1.2.0","build_id":24,"github_url":"https://github.com/bashvlas/x"}*/
!function(){window.x={}}(),window.x.util=function(){var e=new DOMParser;return{open_new_tab:function(e){chrome.tabs.create({active:!0,url:e})},send_to_all_tabs:function(e){chrome.tabs.query({},function(t){t.forEach(function(t){chrome.tabs.sendMessage(t.id,e)})})},list_to_arr:function(e){return Array.prototype.slice.call(e)},text_to_json:function(e){try{return JSON.parse(e)}catch(e){return}},text_to_doc:function(t){return e.parseFromString(t,"text/html")},html_to_doc:function(t){return e.parseFromString(t,"text/html")},doc_to_val:function(e){var t=e[0],n=e[1],r=e[2],o=e[3];if("length"===r)return t.querySelectorAll(n).length;var i=t.querySelector(n);return i?"text"===r?i.innerText:"html"===r?i.innerHTML:"attr"===r?i.getAttribute(o):"value"===r?i.value:null:null},is_defined:function(e){return"undefined"!=typeof e},is_undefined:function(e){return"undefined"==typeof e},normalize_links:function(e){for(var t=e.querySelectorAll("a"),n=t.length;n--;)t[n].href=t[n].href;return e},query:function(e){if("undefined"==typeof e.method){for(var t=e[0],n=e[1],r=[],o=t.length;o--;){for(var i=!0,u=Object.keys(n),c=u.length;c--;){var a=u[c];n[a]!==t[o][a]&&(i=!1)}i&&r.push(t[o])}return r}if("remove"===e.method)for(var o=e.arr.length;o--;){for(var f=e.arr[o],l=!0,s=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),c=s.length;c--;)f[s[c]]!==e.q[s[c]]&&(l=!1);for(var c=d.length;c--;)f[d[c]]===e.q[d[c]]&&(l=!1);l===!0&&e.arr.splice(o,1)}else if("find"===e.method){for(var r=[],o=e.arr.length;o--;){for(var f=e.arr[o],l=!0,s=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),c=s.length;c--;)f[s[c]]!==e.q[s[c]]&&(l=!1);for(var c=d.length;c--;)f[d[c]]===e.q[d[c]]&&(l=!1);l===!0&&r.push(e.arr[o])}return r}},extend:function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},filter:function(e){for(var t=Object.keys(e),n=t.length;n--;)e[t[n]]||delete e[t[n]];return e},wait:function(e){return new Promise(function(t){setTimeout(t,e)})}}}(),window.x.hub=function(){function e(e,n){"undefined"==typeof t[e]&&(t[e]=[]),t[e].push(n)}var t={};return{trigger:function(e,n){"undefined"!=typeof t[e]&&(n=n?n:{},n.event_name=e,t[e].forEach(function(e){e(n)}))},listen:function(t){Object.keys(t).forEach(function(n){e(n,t[n])})},send_runtime_message_rq_to_rs:function(e){window.chrome.runtime.sendMessage(e)},send_tab_message_rq_to_rs:function(e){return e.all_tabs_flag?void window.chrome.tabs.query({},function(t){t.forEach(function(t){window.chrome.tabs.sendMessage(t.id,e)})}):new Promise(function(t){window.chrome.tabs.sendMessage(e.tab_id,e,t)})}}}(),window.x.test=function(){return{test:function(e,t,n,r){return Promise.all([x.ajax.fetch({method:"get_doc",url:n}),x.ajax.fetch({method:"get_json",url:r})]).then(function(n){var r=n[0].body.firstElementChild,o=n[1],i=t(n[0]),u=x.test.compare(o,i);x.test.log_test_case(e,r,o,i,u)})},compare:function(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if("object"==typeof e&&"object"==typeof t){for(var n,r=Object.keys(e),o=Object.keys(t),i=r.length;i--;)if(n=x.test.compare(e[r[i]],t[r[i]]),n===!1)return!1;for(var i=o.length;i--;)if(n=x.test.compare(e[o[i]],t[o[i]]),n===!1)return!1;return!0}return!1},log_test_case:function(e,t,n,r,o){var i=o?"color:green":"color:red";console.groupCollapsed("%c "+e,i),console.log(t),console.log(n),console.log(r),console.groupEnd()}}}(),window.x.ajax=function(){function e(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function t(t){var n=new Headers(t.headers||{});return"get_json"===t.method?window.fetch(t.url,{method:"GET",credentials:"include",headers:n}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null}):"get_doc"===t.method?window.fetch(t.url,{method:"GET",credentials:"include",headers:n}).then(function(e){return e.text().then(function(e){return x.util.text_to_doc(e)})}).catch(function(e){return null}):"get_blob"===t.method?window.fetch(t.url,{method:"GET",credentials:"include",headers:n}).then(function(e){return e.blob()}).catch(function(e){return null}):"get_text"===t.method?window.fetch(t.url,{method:"GET",credentials:"include",headers:n}).then(function(e){return e.text()}).catch(function(e){return null}):"post_json_get_json"===t.method?(n.append("Content-Type","application/json"),window.fetch(t.url,{method:"POST",credentials:"include",body:JSON.stringify(t.body),headers:n}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null})):"post"===t.method?(n.append("Content-Type","application/x-www-form-urlencoded"),window.fetch(t.url,{method:"POST",credentials:"include",body:e(t.body),headers:n}).then(function(e){return e.text().then(function(e){return x.util.text_to_json(e)})}).catch(function(e){return null})):void 0}return t}(),window.x.query=function(){return{query:function(e){if("undefined"==typeof e.method){for(var t=e[0],n=e[1],r=[],o=t.length;o--;){for(var i=!0,u=Object.keys(n),c=u.length;c--;){var a=u[c];n[a]!==t[o][a]&&(i=!1)}i&&r.push(t[o])}return r}if("remove"===e.method)for(var o=e.arr.length;o--;){for(var f=e.arr[o],l=!0,s=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),c=s.length;c--;)f[s[c]]!==e.q[s[c]]&&(l=!1);for(var c=d.length;c--;)f[d[c]]===e.q[d[c]]&&(l=!1);l===!0&&e.arr.splice(o,1)}else if("find"===e.method){for(var r=[],o=e.arr.length;o--;){for(var f=e.arr[o],l=!0,s=Object.keys(e.q||{}),d=Object.keys(e.nq||{}),c=s.length;c--;)f[s[c]]!==e.q[s[c]]&&(l=!1);for(var c=d.length;c--;)f[d[c]]===e.q[d[c]]&&(l=!1);l===!0&&r.push(e.arr[o])}return r}}}}(),window.x.storage=function(){return{get:function(e){var t,n=e.split(".");return new Promise(function(e){window.chrome.storage.local.get(null,function(r){t=r;for(var o=0;o<n.length;o++){if(void 0===typeof t[n[o]]){e(void 0);break}t=t[n[o]]}e(t)})})},set:function(e,t){var n,r=e.split(".");return new Promise(function(e){window.chrome.storage.local.get(null,function(o){n=o;for(var i=0;i<r.length;i++)if(i===r.length-1)n[r[i]]=t;else{if(void 0===typeof n[r[i]]){e(!1);break}n=n[r[i]]}window.chrome.storage.local.set(o,e.bind(this,!0))})})}}}(),window.x.detect=function(){function e(e){var t=e.root||document,n=e.callback,r=e.method||"normal",o=e.selector||"*";if("normal"===r){t=t||document;for(var i=t.querySelectorAll(o),u=0;u<i.length;u++)"1"!==i[0].dataset.detected&&(i[0].dataset.detected="1",n(i[0]));var c=new MutationObserver(function(e){var r=t.querySelectorAll(o);if(r)for(var i=0;i<r.length;i++)"1"!==r[i].dataset.detected&&(r[i].dataset.detected="1",n(r[i]))});c.observe(t,{childList:!0,subtree:!0})}else{if("detect_once"===r)return new Promise(function(e){var n=t.querySelector(o);if(n)e(n);else{var r=new MutationObserver(function(){var n=t.querySelector(o);n&&(e(n),r.disconnect(t))});r.observe(t,{childList:!0,subtree:!0})}});if("wait_for"===r)return new Promise(function(e){var t=!1,n=$(o,root).get(0);if(n)e(n);else{var r=new MutationObserver(function(){t===!1&&(n=$(o,root).get(0),n&&(e(n),r.disconnect(root),t=!0))});r.observe(root,{childList:!0,subtree:!0})}})}}return e}(),window.x.ajax=function(){var e={};return chrome.runtime.onMessage.addListener(function(t,n,r){if("bg_api"===t._target&&e[t.api_name]&&e[t.api_name][t.method_name]){var o=e[t.api_name][t.method_name](input);if(o instanceof Promise)return o.then(r),!0;r(o)}}),{register:function(t,n){e[t]=n},exec:function(e,t,n){return new Promise(function(r){chrome.runtime.sendMessage({_target:"bg_api",api_name:e,method_name:t,input:n},r)})}}}();